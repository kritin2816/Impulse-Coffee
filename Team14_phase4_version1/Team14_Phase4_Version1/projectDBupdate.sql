-- Update the coffee cost for a specific coffee ID
UPDATE S24_S003_T14_FINAL_COFFEE_COST
SET COFFEE_COST = '650'
WHERE COFFEE_ID = '101';

-- Display the updated row for the specified coffee ID
SET PAGESIZE 700
SET LINESIZE 250
COL COFFEE_ID FORMAT 9999
COL FINAL_COST FORMAT 9999
SELECT *
FROM S24_S003_T14_FINAL_COFFEE_COST 
WHERE COFFEE_ID = '101';

-- Update the city and state for a specific customer ID
UPDATE S24_S003_T14_CUSTOMER
SET CITY = 'Hyderabad',
    STATE = 'Telangana'
WHERE CUST_ID = '1017';

-- Update the coffee ID for a specific customer ID in the purchase table
UPDATE S24_S003_T14_PURCHASE
SET COFFEE_ID = '106'
WHERE CUST_ID = '1066';

-- Display the updated row for the specified customer ID
SET PAGESIZE 700
SET LINESIZE 250
COL CUST_ID FORMAT A30
COL NAME FORMAT A30
COL CITY FORMAT A30
COL CUST_ID FORMAT 9999
SELECT CUST_ID, NAME, CITY
FROM S24_S003_T14_CUSTOMER 
WHERE CUST_ID = '1017';

-- Update the preferred flavor for a specific customer ID
UPDATE S24_S003_T14_CUSTOMER
SET PREFERRED_FLAVOR = 'Cinammon'
WHERE CUST_ID = '1066';

-- Delete records from the customer date of purchase table for a specific customer ID
DELETE FROM S24_S003_T14_CUSTOMER_DATEOFPURCHASE WHERE CUSTOMER_ID = '1058';

-- Display the deleted row for the specified customer ID
SELECT * FROM S24_S003_T14_CUSTOMER_DATEOFPURCHASE WHERE CUSTOMER_ID = '1058';

-- Insert new customer records 
INSERT INTO S24_S003_T14_CUSTOMER VALUES('1087','Shreshta','4431338515','Mysore','Karnataka','560102','shreshta@gmail.com', TO_DATE('15/03/2004','DD/MM/YYYY'),'F','Maple');
INSERT INTO S24_S003_T14_CUSTOMER VALUES('1088','Sharath','4423041644','Mysore','Karnataka','560102','sharath@gmail.com', TO_DATE('03/11/2005','DD/MM/YYYY'),'M','Maple');
INSERT INTO S24_S003_T14_CUSTOMER VALUES('1089','Nayana','2482923356','Mysore','Karnataka','560102','nayana@gmail.com', TO_DATE('07/09/2002','DD/MM/YYYY'),'F','Maple');
INSERT INTO S24_S003_T14_CUSTOMER VALUES('1090','Jayanth','1516972346','Mysore','Karnataka','560102','jayanth@gmail.com', TO_DATE('28/09/2001','DD/MM/YYYY'),'M','Chocolate');
INSERT INTO S24_S003_T14_CUSTOMER VALUES('1091','Krishna','5990483568','Mysore','Karnataka','560102','krishna@gmail.com', TO_DATE('02/03/1997','DD/MM/YYYY'),'M','Chocolate');
INSERT INTO S24_S003_T14_CUSTOMER VALUES('1092','Divya','5959971890','Mysore','Karnataka','560102','divya@gmail.com', TO_DATE('05/03/1996','DD/MM/YYYY'),'F','Raspberry');
INSERT INTO S24_S003_T14_CUSTOMER VALUES('1093','Kunj','8779065650','Mysore','Karnataka','560102','kunj@gmail.com', TO_DATE('18/12/1999','DD/MM/YYYY'),'M','Raspberry');
INSERT INTO S24_S003_T14_CUSTOMER VALUES('1094','Dev','0827753905','Mysore','Karnataka','560102','dev@gmail.com', TO_DATE('09/06/2000','DD/MM/YYYY'),'M','Vanilla');


-- Insert new customer feedback records 
INSERT INTO S24_S003_T14_CUSTOMER_FEEDBACK VALUES('1087','85736','3');
INSERT INTO S24_S003_T14_CUSTOMER_FEEDBACK VALUES('1088','85736','4');
INSERT INTO S24_S003_T14_CUSTOMER_FEEDBACK VALUES('1090','85736','1');
INSERT INTO S24_S003_T14_CUSTOMER_FEEDBACK VALUES('1091','85736','2');
INSERT INTO S24_S003_T14_CUSTOMER_FEEDBACK VALUES('1092','85736','1');
INSERT INTO S24_S003_T14_CUSTOMER_FEEDBACK VALUES('1093','85736','3');
INSERT INTO S24_S003_T14_CUSTOMER_FEEDBACK VALUES('1094','85736','3');
INSERT INTO S24_S003_T14_CUSTOMER_FEEDBACK VALUES('1089','85736','2');


-- Insert new customer mode of payment records
INSERT INTO S24_S003_T14_CUSTOMER_MODEOFPAYMENT VALUES('1087','85736','UPI');
INSERT INTO S24_S003_T14_CUSTOMER_MODEOFPAYMENT VALUES('1088','85736','Card');
INSERT INTO S24_S003_T14_CUSTOMER_MODEOFPAYMENT VALUES('1089','85736','Cash');
INSERT INTO S24_S003_T14_CUSTOMER_MODEOFPAYMENT VALUES('1090','85736','UPI');
INSERT INTO S24_S003_T14_CUSTOMER_MODEOFPAYMENT VALUES('1091','85736','Card');
INSERT INTO S24_S003_T14_CUSTOMER_MODEOFPAYMENT VALUES('1092','85736','Cash');
INSERT INTO S24_S003_T14_CUSTOMER_MODEOFPAYMENT VALUES('1093','85736','UPI');
INSERT INTO S24_S003_T14_CUSTOMER_MODEOFPAYMENT VALUES('1094','85736','UPI');


-- Insert new customer transaction records 
INSERT INTO S24_S003_T14_CUSTOMER_TRANSACTION VALUES('1087','85736','Robusta Vanilla');
INSERT INTO S24_S003_T14_CUSTOMER_TRANSACTION VALUES('1088','85736','Liberica Hazelnut');
INSERT INTO S24_S003_T14_CUSTOMER_TRANSACTION VALUES('1089','85736','Robusta Vanilla');
INSERT INTO S24_S003_T14_CUSTOMER_TRANSACTION VALUES('1090','85736','Robusta Vanilla');
INSERT INTO S24_S003_T14_CUSTOMER_TRANSACTION VALUES('1091','85736','Robusta Vanilla');
INSERT INTO S24_S003_T14_CUSTOMER_TRANSACTION VALUES('1092','85736','Liberica Hazelnut');
INSERT INTO S24_S003_T14_CUSTOMER_TRANSACTION VALUES('1093','85736','Arabica Hazelnut');
INSERT INTO S24_S003_T14_CUSTOMER_TRANSACTION VALUES('1094','85736','Arabica Hazelnut');


-- Insert new purchase records into the purchase table
INSERT INTO S24_S003_T14_PURCHASE VALUES('1087','85736','102');
INSERT INTO S24_S003_T14_PURCHASE VALUES('1088','85736','117');
INSERT INTO S24_S003_T14_PURCHASE VALUES('1089','85736','102');
INSERT INTO S24_S003_T14_PURCHASE VALUES('1090','85736','106');
INSERT INTO S24_S003_T14_PURCHASE VALUES('1091','85736','102');
INSERT INTO S24_S003_T14_PURCHASE VALUES('1092','85736','113');
INSERT INTO S24_S003_T14_PURCHASE VALUES('1093','85736','104');
INSERT INTO S24_S003_T14_PURCHASE VALUES('1094','85736','105');

-- Insert new customer date of purchase records 
INSERT INTO S24_S003_T14_CUSTOMER_DATEOFPURCHASE VALUES('1087', '85736', TO_DATE('19/02/2024', 'DD/MM/YYYY'));
INSERT INTO S24_S003_T14_CUSTOMER_DATEOFPURCHASE VALUES('1088', '85736', TO_DATE('1/6/2023', 'DD/MM/YYYY'));
INSERT INTO S24_S003_T14_CUSTOMER_DATEOFPURCHASE VALUES('1089', '85736', TO_DATE('1/3/2024', 'DD/MM/YYYY'));
INSERT INTO S24_S003_T14_CUSTOMER_DATEOFPURCHASE VALUES('1090', '85736', TO_DATE('1/12/2023', 'DD/MM/YYYY'));
INSERT INTO S24_S003_T14_CUSTOMER_DATEOFPURCHASE VALUES('1091', '85736', TO_DATE('1/7/2023', 'DD/MM/YYYY'));
INSERT INTO S24_S003_T14_CUSTOMER_DATEOFPURCHASE VALUES('1092', '85736', TO_DATE('1/3/2024', 'DD/MM/YYYY'));
INSERT INTO S24_S003_T14_CUSTOMER_DATEOFPURCHASE VALUES('1093', '85736', TO_DATE('1/2/2024', 'DD/MM/YYYY'));
INSERT INTO S24_S003_T14_CUSTOMER_DATEOFPURCHASE VALUES('1094', '85736', TO_DATE('1/6/2023', 'DD/MM/YYYY'));



-- Updated queries after updating the values using insert, update and delete

SET PAGESIZE 700
SET LINESIZE 250
COL preferred_flavor FORMAT A30
SELECT sub.preferred_flavor
FROM (
    SELECT DISTINCT preferred_flavor
    FROM S24_S003_T14_CUSTOMER
) sub
WHERE NOT EXISTS (
    SELECT 1
    FROM S24_S003_T14_COFFEE c
    WHERE UPPER(c.name) LIKE '%' || UPPER(sub.preferred_flavor) || '%'
)
GROUP BY sub.preferred_flavor
ORDER BY COUNT(sub.preferred_flavor) DESC;


SET PAGESIZE 700
SET LINESIZE 250
COL coffee_name FORMAT A35
COL total_sales FORMAT A30
COL coffee_ID FORMAT A30
COLUMN total_sales FORMAT 99999
COLUMN coffee_ID FORMAT 99999
SELECT 
    COALESCE(c.NAME, 'Grand Total') AS coffee_name, 
    SUM(fc.COFFEE_COST) AS total_sales, 
    c.coffee_ID
FROM 
    S24_S003_T14_COFFEE c
FULL OUTER JOIN 
    S24_S003_T14_PURCHASE p ON c.COFFEE_ID = p.COFFEE_ID
FULL OUTER JOIN 
    S24_S003_T14_FINAL_COFFEE_COST fc ON p.COFFEE_ID = fc.COFFEE_ID
GROUP BY 
    CUBE(c.NAME,c.coffee_id)
ORDER BY 
    coffee_name NULLS LAST;

SET PAGESIZE 700
SET LINESIZE 250
COL NAME FORMAT A30
COL city FORMAT A20
COL MAX_CITY FORMAT A20
COLUMN MAX_CITY FORMAT 99999
SELECT 
    C.NAME, 
    CU.CITY, 
    COUNT(CU.CITY) AS MAX_CITY
FROM 
    S24_S003_T14_COFFEE_TYPE CT
JOIN 
    S24_S003_T14_COFFEE C ON CT.COFFEE_ID = C.COFFEE_ID
JOIN 
    S24_S003_T14_CUSTOMER_TRANSACTION CTR ON C.NAME = CTR.TRANSACTION_D
JOIN 
    S24_S003_T14_CUSTOMER CU ON CTR.CUSTOMER_ID = CU.CUST_ID
GROUP BY 
    C.NAME, CU.CITY
ORDER BY 
    MAX_CITY DESC 
FETCH FIRST 3 ROWS ONLY;

SET PAGESIZE 700
SET LINESIZE 250
COL PURCHASE_MONTH FORMAT A30
COL NUM_CUSTOMERS FORMAT A20
COLUMN NUM_CUSTOMERS FORMAT 99999
SELECT 
    TO_CHAR(TO_DATE(DATE_OF_PURCHASE, 'DD-MON-RR'), 'MON-RR') AS PURCHASE_MONTH,
    COUNT(DISTINCT CDP.CUSTOMER_ID) AS NUM_CUSTOMERS
FROM 
    S24_S003_T14_CUSTOMER_DATEOFPURCHASE CDP 
JOIN 
    S24_S003_T14_CUSTOMER_TRANSACTION CTR ON CDP.CUSTOMER_ID = CTR.CUSTOMER_ID
JOIN 
    S24_S003_T14_COFFEE C ON C.NAME = CTR.TRANSACTION_D
JOIN 
    S24_S003_T14_PURCHASE P ON P.COFFEE_ID= C.COFFEE_ID
GROUP BY 
    ROLLUP(TO_CHAR(TO_DATE(DATE_OF_PURCHASE, 'DD-MON-RR'), 'MON-RR'))
ORDER BY 
    NUM_CUSTOMERS DESC;
    
    
    

